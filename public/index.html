<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="description" content="å•†å“åƒ¹æ ¼è¿½è¹¤ç³»çµ± - æä¾›å³æ™‚é­šè²¨åƒ¹æ ¼æŸ¥è©¢ã€æ­·å²åƒ¹æ ¼è¶¨å‹¢åˆ†æï¼Œæ”¯æ´æ‰‹å‹•è¼¸å…¥å’Œè‡ªå‹•çˆ¬å–åŠŸèƒ½ï¼Œå¹«åŠ©æ‚¨æŒæ¡å¸‚å ´åƒ¹æ ¼å‹•æ…‹ã€‚">
  <meta name="keywords" content="å•†å“åƒ¹æ ¼,åƒ¹æ ¼è¿½è¹¤,é­šè²¨åƒ¹æ ¼,å¸‚å ´è¡Œæƒ…,åƒ¹æ ¼è¶¨å‹¢">
  <meta name="author" content="å•†å“åƒ¹æ ¼è¿½è¹¤ç³»çµ±">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="å•†å“åƒ¹æ ¼è¿½è¹¤ç³»çµ±">
  <meta property="og:description" content="æä¾›å³æ™‚é­šè²¨åƒ¹æ ¼æŸ¥è©¢ã€æ­·å²åƒ¹æ ¼è¶¨å‹¢åˆ†æï¼Œæ”¯æ´æ‰‹å‹•è¼¸å…¥å’Œè‡ªå‹•çˆ¬å–åŠŸèƒ½ã€‚">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="zh_TW">
  <title>å•†å“åƒ¹æ ¼è¿½è¹¤ç³»çµ±</title>
  
  <!-- å…§åµŒé—œéµ CSS -->
  <style>
    * {
      box-sizing: border-box;
      font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
    }
    body {
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 30px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.2em;
    }
    h2 {
      color: #34495e;
      margin-top: 30px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
    }
    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      align-items: stretch;
      flex-wrap: wrap;
    }
    .form-row > .form-group,
    .form-row > button {
      flex: 1 1 0;
      min-width: 0;
    }
    .form-row > button {
      height: 48px;
      align-self: stretch;
      white-space: nowrap;
    }
    .form-group {
      margin-bottom: 0;
      display: flex;
      align-items: center;
      gap: 0;
    }
    .form-group label {
      display: inline-block;
      min-width: 80px;
      color: #2c3e50;
      font-weight: bold;
      flex-shrink: 0;
    }
    .form-group input {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    .form-group input[type="date"],
    .form-group input[type="text"],
    .form-group input[type="number"] {
      width: 100%;      /* è®“ input å¡«æ»¿ form-group */
      min-width: 0;
      flex-shrink: 1;
    }
    .form-group input:focus {
      border-color: #3498db;
      outline: none;
    }
    button {
      background-color: #3498db;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: background-color 0.3s;
      height: 48px;
      white-space: nowrap;
      flex-shrink: 0;
    }
    button:hover {
      background-color: #2980b9;
    }
    .search-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin: 20px 0;
    }
    .search-box {
      width: 100%;
    }
    .search-box input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
    }
    .date-range {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: nowrap;
    }
    .date-range .form-group {
      margin-bottom: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    /* .form-group input[type="date"] {
      width: 180px;
      flex-shrink: 0;
    }
    .form-group input[type="text"] {
      width: 200px;
      flex-shrink: 0;
    }
    .form-group input[type="number"] {
      width: 120px;
      flex-shrink: 0;
    } */
    .date-range button {
      margin-left: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #f8f9fa;
      color: #2c3e50;
      font-weight: bold;
    }
    tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    tr:hover {
      background-color: #f1f1f1;
    }
    .price {
      text-align: right;
      font-family: monospace;
    }
    .date {
      white-space: nowrap;
    }
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      .search-box {
        flex-direction: column;
      }
      .form-row {
        flex-direction: column;
        gap: 10px;
      }
      .form-group {
        width: 100%;
      }
      .form-group input[type="date"],
      .form-group input[type="text"],
      .form-group input[type="number"] {
        width: 100%;
      }
      button {
        width: 100%;
      }
      th, td {
        padding: 8px;
      }
    }
    @media (max-width: 900px) {
      .form-row {
        flex-direction: column;
      }
      .form-row > .form-group,
      .form-row > button {
        width: 100%;
      }
    }
    .table-info {
      margin: 10px 0;
      color: #666;
      font-size: 0.9em;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .search-status {
      color: #666;
      font-style: italic;
    }
    .no-results {
      text-align: center;
      padding: 20px;
      color: #666;
      font-style: italic;
    }
    .chart-container {
      margin-top: 30px;
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      height: 400px;  /* å›ºå®šé«˜åº¦ */
    }
    .chart-title {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 1.2em;
      font-weight: bold;
    }
    .crawler-status {
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 6px;
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }
    .crawler-status button {
      margin: 0;
      white-space: nowrap;
    }
    
    /* å½ˆçª—æ¨£å¼ */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 4px;
      color: white;
      font-weight: bold;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .toast.show {
      opacity: 1;
    }
    .toast.success {
      background-color: #4CAF50;
    }
    .toast.info {
      background-color: #2196F3;
    }
    .toast.error {
      background-color: #f44336;
    }
    
    /* æ§åˆ¶é¢æ¿è¨­è¨ˆ */
    .control-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      overflow: hidden;
      margin-bottom: 30px;
      border: 1px solid #e2e8f0;
    }
    
    .panel-tabs {
      display: flex;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .tab-btn {
      flex: 1;
      padding: 16px 24px;
      border: none;
      background: transparent;
      color: #64748b;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
    }
    
    .tab-btn:hover {
      background: #e2e8f0;
      color: #334155;
    }
    
    .tab-btn.active {
      background: white;
      color: #1e293b;
      font-weight: 600;
    }
    
    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6, #1d4ed8);
      border-radius: 2px 2px 0 0;
    }
    
    .icon {
      font-size: 1.1em;
    }
    
    .tab-panel {
      display: none;
      padding: 32px;
    }
    
    .tab-panel.active {
      display: block;
    }
    
    .panel-header {
      margin-bottom: 24px;
    }
    
    .panel-header h3 {
      margin: 0 0 4px 0;
      color: #1e293b;
      font-size: 1.3em;
      font-weight: 600;
    }
    
    .subtitle {
      color: #64748b;
      font-size: 0.9em;
    }
    
    .modern-form {
      background: transparent;
    }
    
    .form-layout {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      align-items: end;
    }
    
    .field {
      display: flex;
      flex-direction: column;
    }
    
    .field label {
      margin-bottom: 6px;
      color: #374151;
      font-weight: 500;
      font-size: 0.9em;
    }
    
    .input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .input-wrapper input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #d1d5db;
      border-radius: 8px;
      font-size: 16px;
      background: white;
      transition: all 0.2s ease;
    }
    
    .input-wrapper input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .price-field {
      position: relative;
    }
    
    .currency {
      position: absolute;
      left: 16px;
      color: #6b7280;
      font-weight: 500;
      z-index: 1;
    }
    
    .price-field input {
      padding-left: 48px;
    }
    
    .action-field {
      display: flex;
      align-items: flex-end;
    }
    
    .action-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 120px;
      justify-content: center;
      height: 48px;
    }
    
    .action-btn.primary {
      background: #2563eb;  /* æ›´æ·±çš„è—è‰²ä»¥å¢åŠ å°æ¯”åº¦ */
      color: white;
    }
    
    .action-btn.primary:hover {
      background: #1d4ed8;  /* æ›´æ·±çš„æ‡¸åœé¡è‰² */
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    
    .action-btn.secondary {
      background: #059669;  /* æ›´æ·±çš„ç¶ è‰²ä»¥å¢åŠ å°æ¯”åº¦ */
      color: white;
    }
    
    .action-btn.secondary:hover {
      background: #047857;  /* æ›´æ·±çš„æ‡¸åœé¡è‰² */
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
    }
    
    .action-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .btn-icon {
      font-size: 1.1em;
    }
    
    @media (max-width: 768px) {
      .field-row {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .tab-panel {
        padding: 20px;
      }
      
             .action-btn {
         width: 100%;
       }
     }
    
    /* æŸ¥è©¢é¢æ¿æ¨£å¼ */
    .search-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      overflow: hidden;
      margin-bottom: 30px;
      border: 1px solid #e2e8f0;
    }
    
    .search-header {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 24px 32px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .search-header h2 {
      margin: 0 0 4px 0;
      color: #1e293b;
      font-size: 1.4em;
      font-weight: 600;
    }
    
    .search-description {
      margin: 0;
      color: #64748b;
      font-size: 0.9em;
    }
    
    .search-content {
      padding: 32px;
    }
    
    .search-filters {
      display: flex;
      flex-direction: column;
      gap: 24px;
      margin-bottom: 24px;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
    }
    
    .filter-group label {
      margin-bottom: 8px;
      color: #374151;
      font-weight: 500;
      font-size: 0.9em;
    }
    
    .search-input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .search-input-wrapper input {
      width: 100%;
      padding: 14px 16px 14px 48px;
      border: 2px solid #d1d5db;
      border-radius: 12px;
      font-size: 16px;
      background: white;
      transition: all 0.2s ease;
    }
    
    .search-input-wrapper input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .search-icon {
      position: absolute;
      left: 16px;
      color: #9ca3af;
      font-size: 1.1em;
    }
    
    .date-filters {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 20px;
      align-items: end;
    }
    
    .date-group {
      display: flex;
      flex-direction: column;
    }
    
    .date-group label {
      margin-bottom: 8px;
      color: #374151;
      font-weight: 500;
      font-size: 0.9em;
    }
    
    .date-group input {
      padding: 12px 16px;
      border: 2px solid #d1d5db;
      border-radius: 8px;
      font-size: 16px;
      background: white;
      transition: all 0.2s ease;
    }
    
    .date-group input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .search-action {
      display: flex;
      align-items: flex-end;
    }
    
    .search-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      background: #6366f1;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 100px;
      justify-content: center;
      height: 48px;
    }
    
    .search-btn:hover {
      background: #4f46e5;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }
    
    .search-results-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: #f8fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    
    .result-count .count-text {
      color: #475569;
      font-weight: 500;
      font-size: 0.9em;
    }
    
    .search-status {
      color: #6366f1;
      font-style: italic;
      font-size: 0.9em;
    }
    
    @media (max-width: 768px) {
      .search-header {
        padding: 20px;
      }
      
      .search-content {
        padding: 20px;
      }
      
      .date-filters {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .search-btn {
        width: 100%;
      }
      
      .search-results-info {
        flex-direction: column;
        gap: 8px;
        text-align: center;
             }
     }
    
    /* è³‡æ–™è¡¨æ ¼æ¨£å¼ */
    .data-table-container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      overflow: hidden;
      margin-bottom: 30px;
      border: 1px solid #e2e8f0;
    }
    
    .table-header {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 20px 32px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .table-header h3 {
      margin: 0;
      color: #1e293b;
      font-size: 1.2em;
      font-weight: 600;
    }
    
    .table-wrapper {
      overflow-x: auto;
    }
    
    .modern-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    
    .modern-table thead {
      background: #f8fafc;
    }
    
    .modern-table th {
      padding: 16px 20px;
      text-align: left;
      color: #374151;
      font-weight: 600;
      font-size: 0.9em;
      border-bottom: 2px solid #e2e8f0;
      white-space: nowrap;
    }
    
    .modern-table td {
      padding: 16px 20px;
      border-bottom: 1px solid #f1f5f9;
      color: #475569;
      font-size: 0.95em;
    }
    
    .modern-table tbody tr {
      transition: background-color 0.2s ease;
    }
    
    .modern-table tbody tr:hover {
      background-color: #f8fafc;
    }
    
    .modern-table tbody tr:nth-child(even) {
      background-color: #fbfcfd;
    }
    
    .modern-table tbody tr:nth-child(even):hover {
      background-color: #f1f5f9;
    }
    
    .date-col {
      width: 140px;
    }
    
    .product-col {
      width: auto;
      min-width: 120px;
    }
    
    .price-col {
      width: 120px;
      text-align: right;
    }
    
    .modern-table .price {
      text-align: right;
      font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
      font-weight: 600;
      color: #059669;
    }
    
    .modern-table .date {
      font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
      color: #6366f1;
    }
    
    .no-results {
      text-align: center;
      padding: 40px 20px;
      color: #9ca3af;
      font-style: italic;
      background: #f9fafb;
    }
    
    @media (max-width: 768px) {
      .table-header {
        padding: 16px 20px;
      }
      
      .modern-table th,
      .modern-table td {
        padding: 12px 16px;
        font-size: 0.9em;
      }
      
      .date-col {
        width: 100px;
      }
      
      .price-col {
        width: 100px;
      }
    }
    
    /* èˆŠæ¨£å¼ä¿æŒå…¼å®¹ */
    .form-actions {
      margin-left: auto;
      display: flex;
      gap: 10px;
    }
    @media (max-width: 768px) {
      .form-actions {
        margin-left: 0;
        width: 100%;
        justify-content: stretch;
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
  
  <!-- éé—œéµ CSS å»¶é²è¼‰å…¥ -->
  <link rel="stylesheet" href="/stylesheets/style.css" media="print" onload="this.media='all'">
  
  <!-- ç›´æ¥è¼‰å…¥ Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="container" role="main">
    <h1>å•†å“åƒ¹æ ¼è¿½è¹¤ç³»çµ±</h1>
    
    <!-- å½ˆçª—å®¹å™¨ -->
    <div id="toast" class="toast" role="alert" aria-live="polite"></div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
      <div class="panel-tabs" role="tablist" aria-label="åŠŸèƒ½é¸é …">
        <button class="tab-btn active" 
                id="manual-tab"
                role="tab" 
                aria-selected="true" 
                aria-controls="manual-panel"
                tabindex="0">
          <i class="icon" aria-hidden="true">âœï¸</i>
          æ‰‹å‹•è¼¸å…¥
        </button>
        <button class="tab-btn" 
                id="auto-tab"
                role="tab" 
                aria-selected="false" 
                aria-controls="auto-panel"
                tabindex="-1">
          <i class="icon" aria-hidden="true">ğŸ”„</i>
          è‡ªå‹•çˆ¬å–
        </button>
        <button class="tab-btn" 
                id="search-tab"
                role="tab" 
                aria-selected="false" 
                aria-controls="search-panel"
                tabindex="-1">
          <i class="icon" aria-hidden="true">ğŸ“Š</i>
          è³‡æ–™æŸ¥è©¢
        </button>
      </div>
      
      <!-- æ‰‹å‹•è¼¸å…¥é¢æ¿ -->
      <div id="manual-panel" 
           class="tab-panel active" 
           role="tabpanel" 
           aria-labelledby="manual-tab"
           tabindex="0">
        <div class="panel-header">
          <h2>æ–°å¢å•†å“åƒ¹æ ¼è¨˜éŒ„</h2>
          <span class="subtitle">æ‰‹å‹•è¼¸å…¥å•†å“åƒ¹æ ¼è³‡è¨Šåˆ°è³‡æ–™åº«</span>
        </div>
        <form id="priceForm" class="modern-form" aria-label="æ–°å¢åƒ¹æ ¼è¨˜éŒ„è¡¨å–®">
          <div class="form-layout">
            <div class="field-row">
              <div class="field">
                <label for="date">æ—¥æœŸ</label>
                <div class="input-wrapper">
                  <input type="date" 
                         id="date" 
                         name="date" 
                         required 
                         aria-required="true">
                </div>
              </div>
              <div class="field">
                <label for="productName">å•†å“åç¨±</label>
                <div class="input-wrapper">
                  <input type="text" 
                         id="productName" 
                         name="productName" 
                         required 
                         placeholder="ä¾‹å¦‚ï¼šå³éƒ­é­š" 
                         aria-required="true">
                </div>
              </div>
            </div>
            <div class="field-row">
              <div class="field">
                <label for="price">åƒ¹æ ¼ (å…ƒ/å…¬æ–¤)</label>
                <div class="input-wrapper price-field">
                  <span class="currency" aria-hidden="true">NT$</span>
                  <input type="number" 
                         id="price" 
                         name="price" 
                         step="0.01" 
                         required 
                         placeholder="0.00" 
                         aria-required="true">
                </div>
              </div>
              <div class="field action-field">
                <button type="submit" 
                        class="action-btn primary" 
                        aria-label="æ–°å¢åƒ¹æ ¼è¨˜éŒ„">
                  <span class="btn-icon" aria-hidden="true">+</span>
                  æ–°å¢è¨˜éŒ„
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
      
      <!-- è‡ªå‹•çˆ¬å–é¢æ¿ -->
      <div id="auto-panel" 
           class="tab-panel" 
           role="tabpanel" 
           aria-labelledby="auto-tab"
           tabindex="0"
           hidden>
        <div class="panel-header">
          <h2>è‡ªå‹•åƒ¹æ ¼çˆ¬å–</h2>
          <span class="subtitle">å¾æ¼æ¥­ç½²å®˜ç¶²è‡ªå‹•ç²å–æœ€æ–°åƒ¹æ ¼è³‡è¨Š</span>
        </div>
        <form id="crawlerForm" class="modern-form" aria-label="è‡ªå‹•çˆ¬å–è¡¨å–®">
          <div class="form-layout">
            <div class="field-row">
              <div class="field">
                <label for="fishName">é­šç¨®åç¨±</label>
                <div class="input-wrapper">
                  <input type="text" 
                         id="fishName" 
                         placeholder="è«‹è¼¸å…¥è¦æœå°‹çš„é­šç¨®" 
                         value="å³éƒ­é­š" 
                         required 
                         aria-required="true">
                </div>
              </div>
              <div class="field action-field">
                <button type="button" 
                        onclick="runCrawler()" 
                        class="action-btn secondary"
                        aria-label="é–‹å§‹çˆ¬å–åƒ¹æ ¼è³‡æ–™">
                  <span class="btn-icon" aria-hidden="true">ğŸ”</span>
                  é–‹å§‹çˆ¬å–
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- æŸ¥è©¢å€åŸŸ -->
    <div id="search-panel" 
         class="search-panel" 
         role="tabpanel" 
         aria-labelledby="search-tab"
         tabindex="0"
         hidden>
      <div class="search-header">
        <h2>ğŸ“Š è³‡æ–™æŸ¥è©¢</h2>
        <p class="search-description">æœå°‹å’Œç¯©é¸åƒ¹æ ¼è¨˜éŒ„</p>
      </div>
      
      <div class="search-content">
        <div class="search-filters" role="search" aria-label="æœå°‹éæ¿¾å™¨">
          <div class="filter-group">
            <label for="searchInput">ğŸ” å•†å“åç¨±</label>
            <div class="search-input-wrapper">
              <input type="text" 
                     id="searchInput" 
                     name="searchInput" 
                     placeholder="è«‹è¼¸å…¥å•†å“åç¨±é€²è¡Œæœå°‹..." 
                     oninput="handleSearch()" 
                     aria-label="æœå°‹å•†å“åç¨±">
              <span class="search-icon" aria-hidden="true">ğŸ”</span>
            </div>
          </div>
          
          <div class="date-filters">
            <div class="date-group">
              <label for="startDate">ğŸ“… é–‹å§‹æ—¥æœŸ</label>
              <input type="date" 
                     id="startDate" 
                     name="startDate" 
                     onchange="handleSearch()" 
                     aria-label="é¸æ“‡é–‹å§‹æ—¥æœŸ">
            </div>
            <div class="date-group">
              <label for="endDate">ğŸ“… çµæŸæ—¥æœŸ</label>
              <input type="date" 
                     id="endDate" 
                     name="endDate" 
                     onchange="handleSearch()" 
                     aria-label="é¸æ“‡çµæŸæ—¥æœŸ">
            </div>
            <div class="search-action">
              <button onclick="searchRecords()" 
                      class="search-btn" 
                      aria-label="åŸ·è¡Œæœå°‹">
                <span aria-hidden="true">ğŸ”</span>
                æœå°‹
              </button>
            </div>
          </div>
        </div>
        
        <!-- æœå°‹çµæœç‹€æ…‹ -->
        <div class="search-results-info" role="status" aria-live="polite">
          <div class="result-count">
            <span id="recordCount" class="count-text"></span>
          </div>
          <div class="search-status-wrapper">
            <span id="searchStatus" class="search-status"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- è³‡æ–™è¡¨æ ¼ -->
    <div class="data-table-container" id="dataTableContainer" role="region" aria-label="åƒ¹æ ¼è³‡æ–™è¡¨æ ¼">
      <div class="table-header">
        <h2>ğŸ“‹ è³‡æ–™åˆ—è¡¨</h2>
      </div>
      <div class="table-wrapper">
        <table id="priceTable" class="modern-table" role="grid" aria-label="åƒ¹æ ¼è¨˜éŒ„è¡¨æ ¼">
          <thead>
            <tr>
              <th class="date-col" role="columnheader" scope="col">æ—¥æœŸ</th>
              <th class="product-col" role="columnheader" scope="col">å•†å“åç¨±</th>
              <th class="price-col" role="columnheader" scope="col">åƒ¹æ ¼</th>
            </tr>
          </thead>
          <tbody id="priceTableBody">
          </tbody>
        </table>
      </div>
    </div>

    <!-- åƒ¹æ ¼è¶¨å‹¢åœ– -->
    <div class="chart-container" role="region" aria-label="åƒ¹æ ¼è¶¨å‹¢åœ–è¡¨">
      <div class="chart-title">åƒ¹æ ¼è¶¨å‹¢åœ–</div>
      <canvas id="priceChart" aria-label="åƒ¹æ ¼è¶¨å‹¢åœ–è¡¨" role="img"></canvas>
    </div>
  </div>

  <script>
    let searchTimeout;
    let lastSearchTerm = '';
    let isSearching = false;
    let priceChart = null;
    let priceRecords = []; // æ·»åŠ å…¨åŸŸè®Šæ•¸

    // é˜²æŠ–å‹•å‡½æ•¸
    function debounce(func, wait) {
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(searchTimeout);
          func(...args);
        };
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(later, wait);
      };
    }

    // é¡¯ç¤ºå½ˆçª—æç¤º
    function showToast(message, type = 'info') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type} show`;
        
        // 3ç§’å¾Œè‡ªå‹•éš±è—
        setTimeout(() => {
            toast.className = 'toast';
        }, 3000);
    }

    // è¼‰å…¥æ‰€æœ‰åƒ¹æ ¼è¨˜éŒ„
    async function loadPrices() {
      try {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const searchTerm = document.getElementById('searchInput').value.trim();
        
        let url = 'http://localhost:3000/api/prices?limit=20';
        if (startDate) url += `&startDate=${startDate}`;
        if (endDate) url += `&endDate=${endDate}`;
        
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error('è¼‰å…¥åƒ¹æ ¼è¨˜éŒ„å¤±æ•—');
        }
        
        const data = await response.json();
        priceRecords = data.records;
        updateTable(data.records);
        updateRecordCount(data.total, data.limit);
        document.getElementById('searchStatus').textContent = '';
      } catch (err) {
        console.error('è¼‰å…¥åƒ¹æ ¼è¨˜éŒ„å¤±æ•—:', err);
        showToast('è¼‰å…¥åƒ¹æ ¼è¨˜éŒ„å¤±æ•—', 'error');
      }
    }

    // æ›´æ–°è¨˜éŒ„æ•¸é‡é¡¯ç¤º
    function updateRecordCount(total, limit) {
      const countElement = document.getElementById('recordCount');
      const searchTerm = document.getElementById('searchInput').value.trim();
      
      if (!searchTerm && limit) {
        countElement.textContent = `é¡¯ç¤ºæœ€æ–°çš„ ${limit} ç­†è¨˜éŒ„ï¼Œå…± ${total} ç­†`;
      } else {
        countElement.textContent = `å…± ${total} ç­†è¨˜éŒ„`;
      }
    }

    // è™•ç†æœå°‹è¼¸å…¥
    const handleSearch = debounce(async function() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      
      if (searchTerm === '') {
        await loadPrices();
        document.querySelector('.chart-container').style.display = 'none';
        return;
      }

      if (searchTerm === lastSearchTerm && priceRecords.length > 0) {
        return; // å¦‚æœæœå°‹è©ç›¸åŒä¸”å·²æœ‰çµæœï¼Œä¸é‡è¤‡æœå°‹
      }

      lastSearchTerm = searchTerm;
      await searchRecords();
    }, 500);

    // è™•ç†è¡¨å–®æäº¤
    document.getElementById('priceForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const date = document.getElementById('date').value;
      const productName = document.getElementById('productName').value;
      const avgPrice = parseFloat(document.getElementById('price').value);
      
      try {
        const response = await fetch('/api/prices', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ date, product_name: productName, avg_price: avgPrice })
        });
        
        if (!response.ok) {
          throw new Error('æ–°å¢è¨˜éŒ„å¤±æ•—');
        }
        
        // æ¸…ç©ºè¡¨å–®
        e.target.reset();
        
        // é‡æ–°è¼‰å…¥åƒ¹æ ¼è¨˜éŒ„
        await loadPrices();
        
        alert('æ–°å¢è¨˜éŒ„æˆåŠŸï¼');
      } catch (error) {
        console.error('æ–°å¢è¨˜éŒ„éŒ¯èª¤:', error);
        alert('æ–°å¢è¨˜éŒ„å¤±æ•—ï¼š' + error.message);
      }
    });

    // æœå°‹åŠŸèƒ½
    async function searchRecords() {
      if (isSearching) return;
      
      const searchTerm = document.getElementById('searchInput').value.trim();
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const searchStatus = document.getElementById('searchStatus');
      
      if (!searchTerm) {
        await loadPrices();
        return;
      }

      try {
        isSearching = true;
        searchStatus.textContent = 'æœå°‹ä¸­...';
        
        let url = `http://localhost:3000/api/prices/search?term=${encodeURIComponent(searchTerm)}`;
        if (startDate) url += `&startDate=${startDate}`;
        if (endDate) url += `&endDate=${endDate}`;
        
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error('æœå°‹è«‹æ±‚å¤±æ•—');
        }
        
        const data = await response.json();
        priceRecords = data.records;
        updateTable(data.records);
        updateRecordCount(data.total, data.limit);
        
        if (data.total === 0) {
          searchStatus.textContent = `æ‰¾ä¸åˆ°åŒ…å« "${searchTerm}" çš„è¨˜éŒ„`;
          document.querySelector('.chart-container').style.display = 'none';
        } else {
          searchStatus.textContent = `æ‰¾åˆ° ${data.total} ç­†åŒ…å« "${searchTerm}" çš„è¨˜éŒ„`;
          document.querySelector('.chart-container').style.display = 'block';
        }
      } catch (err) {
        console.error('æœå°‹å¤±æ•—:', err);
        searchStatus.textContent = 'æœå°‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
        document.querySelector('.chart-container').style.display = 'none';
      } finally {
        isSearching = false;
      }
    }

    // æ›´æ–°è¡¨æ ¼é¡¯ç¤º
    function updateTable(prices) {
      const tbody = document.getElementById('priceTableBody');
      const chartContainer = document.querySelector('.chart-container');
      tbody.innerHTML = '';
      
      if (prices.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td colspan="3" class="no-results">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„è¨˜éŒ„</td>
        `;
        tbody.appendChild(row);
        chartContainer.style.display = 'none';
        return;
      }
      
      prices.forEach(price => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="date">${price.date}</td>
          <td>${price.product_name}</td>
          <td class="price">NT$ ${price.avg_price.toFixed(2)}</td>
        `;
        tbody.appendChild(row);
      });

      // åªæœ‰åœ¨æœ‰æœå°‹å•†å“åç¨±æ™‚æ‰é¡¯ç¤ºè¶¨å‹¢åœ–
      const searchTerm = document.getElementById('searchInput').value.trim();
      if (searchTerm) {
        chartContainer.style.display = 'block';
        updatePriceChart(prices);
      } else {
        chartContainer.style.display = 'none';
      }
    }

    // æ›´æ–°åƒ¹æ ¼è¶¨å‹¢åœ–
    async function updatePriceChart(prices) {
      try {
        // ç¢ºä¿ Chart.js å·²è¼‰å…¥
        if (typeof Chart === 'undefined') {
          console.error('Chart.js å°šæœªè¼‰å…¥');
          return;
        }

        // æŒ‰æ—¥æœŸæ’åº
        const sortedPrices = [...prices].sort((a, b) => new Date(a.date) - new Date(b.date));
        
        // å¦‚æœæ•¸æ“šé»å¤ªå¤šï¼Œé€²è¡ŒæŠ½æ¨£
        let displayPrices = sortedPrices;
        if (sortedPrices.length > 50) {
          const step = Math.ceil(sortedPrices.length / 50);
          displayPrices = sortedPrices.filter((_, index) => index % step === 0);
        }
        
        const dates = displayPrices.map(price => price.date);
        const avgPrices = displayPrices.map(price => price.avg_price);

        // å¦‚æœå·²å­˜åœ¨åœ–è¡¨ï¼Œå…ˆéŠ·æ¯€å®ƒ
        if (priceChart) {
          priceChart.destroy();
        }

        const ctx = document.getElementById('priceChart').getContext('2d');
        priceChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: dates,
            datasets: [{
              label: 'å¹³å‡åƒ¹æ ¼',
              data: avgPrices,
              borderColor: '#3498db',
              backgroundColor: 'rgba(52, 152, 219, 0.1)',
              borderWidth: 2,
              fill: true,
              tension: 0.4,
              pointRadius: 3,
              pointHoverRadius: 5
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
              duration: 1000
            },
            plugins: {
              title: {
                display: true,
                text: 'åƒ¹æ ¼è¶¨å‹¢è®ŠåŒ–'
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `NT$ ${context.raw.toFixed(2)}`;
                  }
                }
              },
              legend: {
                display: false
              }
            },
            scales: {
              x: {
                ticks: {
                  maxRotation: 45,
                  minRotation: 45
                }
              },
              y: {
                beginAtZero: false,
                ticks: {
                  callback: function(value) {
                    return 'NT$ ' + value.toFixed(2);
                  }
                }
              }
            }
          }
        });
      } catch (error) {
        console.error('æ›´æ–°åœ–è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
        showToast('æ›´æ–°åœ–è¡¨å¤±æ•—', 'error');
      }
    }

    // åˆ‡æ›æ¨™ç±¤é 
    function switchTab(tabName) {
      // ç§»é™¤æ‰€æœ‰ active é¡åˆ¥
      document.querySelectorAll('[role="tab"]').forEach(tab => {
        tab.classList.remove('active');
        tab.setAttribute('aria-selected', 'false');
        tab.setAttribute('tabindex', '-1');
      });
      
      document.querySelectorAll('[role="tabpanel"]').forEach(panel => {
        panel.classList.remove('active');
        panel.hidden = true;
      });
      
      // æ·»åŠ  active åˆ°é¸ä¸­çš„æ¨™ç±¤
      const selectedTab = document.getElementById(`${tabName}-tab`);
      const selectedPanel = document.getElementById(`${tabName}-panel`);
      
      if (!selectedTab || !selectedPanel) {
        console.error(`æ‰¾ä¸åˆ°æ¨™ç±¤æˆ–é¢æ¿: ${tabName}`);
        return;
      }
      
      selectedTab.classList.add('active');
      selectedTab.setAttribute('aria-selected', 'true');
      selectedTab.setAttribute('tabindex', '0');
      
      selectedPanel.classList.add('active');
      selectedPanel.hidden = false;
      
      // å¦‚æœæ˜¯æœå°‹æ¨™ç±¤ï¼Œé¡¯ç¤ºæœå°‹é¢æ¿å’Œè³‡æ–™è¡¨æ ¼
      if (tabName === 'search') {
        document.getElementById('search-panel').style.display = 'block';
        document.getElementById('dataTableContainer').style.display = 'block';
        // åªåœ¨æœ‰æœå°‹å•†å“åç¨±æ™‚æ‰é¡¯ç¤ºè¶¨å‹¢åœ–
        const searchTerm = document.getElementById('searchInput').value.trim();
        document.querySelector('.chart-container').style.display = searchTerm ? 'block' : 'none';
        loadPrices(); // è¼‰å…¥åƒ¹æ ¼è¨˜éŒ„
      } else {
        document.getElementById('search-panel').style.display = 'none';
        document.getElementById('dataTableContainer').style.display = 'none';
        document.querySelector('.chart-container').style.display = 'none';
      }
    }

    // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      console.log('é é¢è¼‰å…¥å®Œæˆï¼Œåˆå§‹åŒ–æ¨™ç±¤é ...'); // é™¤éŒ¯ç”¨
      
      // ç‚ºæ¨™ç±¤æŒ‰éˆ•æ·»åŠ é»æ“Šäº‹ä»¶
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tabName = this.id.replace('-tab', '');
          console.log('é»æ“Šæ¨™ç±¤:', tabName); // é™¤éŒ¯ç”¨
          switchTab(tabName);
        });
      });
      
      // åˆå§‹åŒ–æ‰‹å‹•è¼¸å…¥æ¨™ç±¤
      switchTab('manual');
    });

    // åŸ·è¡Œçˆ¬èŸ²
    async function runCrawler() {
      try {
        // ç²å–ç”¨æˆ¶è¼¸å…¥çš„é­šç¨®åç¨±
        const fishName = document.getElementById('fishName').value.trim();
        if (!fishName) {
          showToast('è«‹è¼¸å…¥é­šç¨®åç¨±', 'error');
          return;
        }
        
        // ç¦ç”¨æŒ‰éˆ•
        const button = document.querySelector('button[onclick="runCrawler()"]');
        button.disabled = true;
        button.textContent = 'çˆ¬èŸ²åŸ·è¡Œä¸­...';
        
        // é¡¯ç¤ºåŸ·è¡Œä¸­ç‹€æ…‹
        showToast(`æ­£åœ¨æœå°‹ ${fishName} çš„åƒ¹æ ¼è³‡è¨Šï¼Œè«‹ç¨å€™...`, 'info');
        
        // ç™¼é€è«‹æ±‚ï¼Œç²å–è³‡æ–™ä½†ä¸å„²å­˜
        const response = await fetch('http://localhost:3000/api/crawler/get-data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ fishName: fishName })
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('çˆ¬èŸ²åŸ·è¡Œçµæœ:', result);
        
        // è™•ç†çˆ¬èŸ²çµæœ
        if (result.success && result.data && !result.duplicate) {
          // è³‡æ–™ä¸é‡è¤‡ï¼Œé¡¯ç¤ºç¢ºèªå°è©±æ¡†
          const data = result.data;
          const confirmMessage = `æ‰¾åˆ°ä»¥ä¸‹è³‡æ–™ï¼š\n\næ—¥æœŸï¼š${data.date}\né­šç¨®ï¼š${data.fish_name}\nåƒ¹æ ¼ï¼šNT$ ${data.price.toFixed(2)}\n\næ˜¯å¦è¦å°‡æ­¤è³‡æ–™æ–°å¢åˆ°è³‡æ–™åº«ï¼Ÿ`;
          
          if (confirm(confirmMessage)) {
            // ç”¨æˆ¶ç¢ºèªï¼Œå„²å­˜è³‡æ–™
            try {
              const saveResponse = await fetch('http://localhost:3000/api/crawler/save-data', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  date: data.date,
                  fish_name: data.fish_name,
                  price: data.price
                })
              });
              
              const saveResult = await saveResponse.json();
              if (saveResult.success) {
                showToast('è³‡æ–™å·²æˆåŠŸå„²å­˜åˆ°è³‡æ–™åº«', 'success');
                // é‡æ–°è¼‰å…¥åƒ¹æ ¼è¨˜éŒ„
                await loadPrices();
              } else {
                showToast(saveResult.message || 'å„²å­˜è³‡æ–™å¤±æ•—', 'error');
              }
            } catch (saveError) {
              console.error('å„²å­˜è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', saveError);
              showToast(`å„²å­˜è³‡æ–™å¤±æ•—ï¼š${saveError.message}`, 'error');
            }
          } else {
            showToast('ç”¨æˆ¶å–æ¶ˆå„²å­˜è³‡æ–™', 'info');
          }
        } else if (result.duplicate) {
          // è³‡æ–™é‡è¤‡ï¼Œç›´æ¥æç¤º
          showToast(result.message || 'è³‡æ–™å·²å­˜åœ¨æ–¼è³‡æ–™åº«ä¸­', 'info');
        } else {
          // çˆ¬èŸ²å¤±æ•—æˆ–æ‰¾ä¸åˆ°è³‡æ–™
          const errorMsg = result.error || result.message || 'æ‰¾ä¸åˆ°ç›¸é—œé­šç¨®çš„åƒ¹æ ¼è³‡æ–™';
          showToast(`çˆ¬èŸ²åŸ·è¡Œå¤±æ•—ï¼š${errorMsg}`, 'error');
        }
        
      } catch (error) {
        console.error('åŸ·è¡Œçˆ¬èŸ²æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
        showToast(`çˆ¬èŸ²åŸ·è¡Œå¤±æ•—ï¼š${error.message}`, 'error');
      } finally {
        // é‡æ–°å•Ÿç”¨æŒ‰éˆ•
        const button = document.querySelector('button[onclick="runCrawler()"]');
        button.disabled = false;
        button.textContent = 'è‡ªå‹•å–å¾—é­šåƒ¹';
      }
    }
  </script>
</body>

</html>

